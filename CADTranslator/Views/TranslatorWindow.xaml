<ui:FluentWindow x:Class="CADTranslator.Views.TranslatorWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:vm="clr-namespace:CADTranslator.ViewModels"
                 xmlns:settings="clr-namespace:CADTranslator.Models.API"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:Tools="clr-namespace:CADTranslator.Tools.UI"
                 xmlns:interactivity="http://schemas.microsoft.com/xaml/behaviors"
                 xmlns:behaviors="clr-namespace:CADTranslator.Tools.Behaviors"
                 xmlns:controls="clr-namespace:CADTranslator.Tools.Controls"
                 xmlns:effects="clr-namespace:CADTranslator.Tools.Effects"
                 mc:Ignorable="d"
                 d:DataContext="{d:DesignInstance Type=vm:TranslatorViewModel,IsDesignTimeCreatable=False}"
                 Title="CAD Translator Toolbox"
                 Height="720"
                 Width="1080"
                 WindowStartupLocation="CenterScreen"
                 WindowBackdropType="Mica"
                 d:DesignHeight="2000"
                 Loaded="TranslatorWindow_Loaded"
                 ExtendsContentIntoTitleBar="True">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ui:ThemesDictionary Theme="Light" />
                <ui:ControlsDictionary />
            </ResourceDictionary.MergedDictionaries>

            <Tools:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <Tools:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
            <Tools:ProgressConverter x:Key="ProgressConverter" />
            <Tools:ProgressToGlowColorConverter x:Key="ProgressToGlowColorConverter" />
            <Tools:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />

            <Style TargetType="{x:Type DataGridCell}"
                   BasedOn="{StaticResource {x:Type DataGridCell}}">
                <Setter Property="SnapsToDevicePixels"
                        Value="True" />
                <Setter Property="BorderThickness"
                        Value="1 1 1 1" />
                <Setter Property="BorderBrush"
                        Value="LightBlue" />
            </Style>
            <Style x:Key="DataGridColumnHeaderStyleWithBorders"
                   TargetType="{x:Type DataGridColumnHeader}"
                   BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                <Setter Property="SnapsToDevicePixels"
                        Value="True" />
                <Setter Property="BorderBrush"
                        Value="LightBlue" />
                <Setter Property="BorderThickness"
                        Value="1,1,1,1" />
                <Setter Property="FontSize"
                        Value="20" />
                <Setter Property="HorizontalContentAlignment"
                        Value="Center" />
                <Setter Property="VerticalContentAlignment"
                        Value="Center" />
            </Style>
            <Style x:Key="HoverHighlightNavigationViewItemStyle"
                   TargetType="ui:NavigationViewItem">
                <Setter Property="BorderThickness"
                        Value="1" />
                <Setter Property="BorderBrush"
                        Value="Transparent" />
                <Setter Property="FontSize"
                        Value="14" />
                <Setter Property="FontWeight"
                        Value="SemiBold" />
            </Style>

            <Style x:Key="ComboBoxWithDocumentationButtonStyle"
                   TargetType="{x:Type ComboBox}"
                   BasedOn="{StaticResource {x:Type ComboBox}}">
            </Style>

            <Style TargetType="{x:Type controls:WaveProgressBar}">
                <Setter Property="Background"
                        Value="#7bcdd9" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type controls:WaveProgressBar}">
                            <Viewbox x:Name="Root"
                                     Stretch="Uniform">

                                <Path Width="100"
                                      Height="100"
                                      Fill="{TemplateBinding Background}">
                                    <Path.Data>
                                        <PathGeometry>
                                            <PathGeometry.Figures>
                                                <PathFigure StartPoint="0,100">
                                                    <PathFigure.Segments>
                                                        <LineSegment x:Name="PART_LineSegment"
                                                                     Point="0,0" />
                                                        <BezierSegment x:Name="PART_BezierSegment"
                                                                       Point1="35,0"
                                                                       Point2="65,0"
                                                                       Point3="100,0" />
                                                        <LineSegment Point="100,100" />
                                                    </PathFigure.Segments>
                                                </PathFigure>
                                            </PathGeometry.Figures>
                                        </PathGeometry>
                                    </Path.Data>
                                </Path>
                            </Viewbox>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="RainbowButtonStyle"
                   TargetType="{x:Type Button}">
                <Setter Property="HorizontalContentAlignment"
                        Value="Center" />
                <Setter Property="VerticalContentAlignment"
                        Value="Center" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Button}">
                            <Border x:Name="border"
                                    Padding="{TemplateBinding Padding}"
                                    Background="Transparent"
                                    SnapsToDevicePixels="true"
                                    Width="80"
                                    HorizontalAlignment="Left"
                                    BorderThickness="2"
                                    CornerRadius="4"
                                    BorderBrush="{Binding ElementName=textBlock, Path=Foreground}">
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal">
                                            <Storyboard>
                                                <PointAnimation Storyboard.TargetName="RainbowBrush"
                                                                Storyboard.TargetProperty="StartPoint"
                                                                To="0,0.5"
                                                                Duration="0:0:0.5">
                                                    <PointAnimation.EasingFunction>
                                                        <QuarticEase EasingMode="EaseOut" />
                                                    </PointAnimation.EasingFunction>
                                                </PointAnimation>
                                                <PointAnimation Storyboard.TargetName="RainbowBrush"
                                                                Storyboard.TargetProperty="EndPoint"
                                                                To="1,0.5"
                                                                Duration="0:0:0.5">
                                                    <PointAnimation.EasingFunction>
                                                        <QuarticEase EasingMode="EaseOut" />
                                                    </PointAnimation.EasingFunction>
                                                </PointAnimation>
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="MouseOver">
                                            <Storyboard>
                                                <PointAnimation Storyboard.TargetName="RainbowBrush"
                                                                Storyboard.TargetProperty="StartPoint"
                                                                To="0.5,0"
                                                                Duration="0:0:0.5">
                                                    <PointAnimation.EasingFunction>
                                                        <QuarticEase EasingMode="EaseOut" />
                                                    </PointAnimation.EasingFunction>
                                                </PointAnimation>
                                                <PointAnimation Storyboard.TargetName="RainbowBrush"
                                                                Storyboard.TargetProperty="EndPoint"
                                                                To=".5,1"
                                                                Duration="0:0:0.5">
                                                    <PointAnimation.EasingFunction>
                                                        <QuarticEase EasingMode="EaseOut" />
                                                    </PointAnimation.EasingFunction>
                                                </PointAnimation>
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="Pressed">
                                            <Storyboard SpeedRatio="3">
                                                <PointAnimation Storyboard.TargetName="RainbowBrush"
                                                                Storyboard.TargetProperty="StartPoint"
                                                                To="0.5,0" />
                                                <PointAnimation Storyboard.TargetName="RainbowBrush"
                                                                Storyboard.TargetProperty="EndPoint"
                                                                To=".5,1" />
                                                <DoubleAnimation Storyboard.TargetName="G2"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="0" />
                                                <DoubleAnimation Storyboard.TargetName="G3"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="0" />
                                                <DoubleAnimation Storyboard.TargetName="G4"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="0" />
                                                <DoubleAnimation Storyboard.TargetName="G5"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="0" />
                                                <DoubleAnimation Storyboard.TargetName="G6"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="0" />
                                                <DoubleAnimation Storyboard.TargetName="G7"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="0" />
                                                <DoubleAnimation Storyboard.TargetName="G8"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="1" />
                                                <DoubleAnimation Storyboard.TargetName="G9"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="1" />
                                                <DoubleAnimation Storyboard.TargetName="G10"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="1" />
                                                <DoubleAnimation Storyboard.TargetName="G11"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="1" />
                                                <DoubleAnimation Storyboard.TargetName="G12"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="1" />
                                                <DoubleAnimation Storyboard.TargetName="G13"
                                                                 Storyboard.TargetProperty="Offset"
                                                                 To="1" />
                                            </Storyboard>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                                <Grid>
                                    <TextBlock Foreground="{Binding ElementName=textBlock, Path=Foreground}"
                                               Text="{TemplateBinding Content}"
                                               FontWeight="{TemplateBinding FontWeight}"
                                               FontSize="{TemplateBinding FontSize}">
                                        <TextBlock.Effect>
                                            <BlurEffect Radius="15"
                                                        RenderingBias="Quality" />
                                        </TextBlock.Effect>
                                    </TextBlock>
                                    <TextBlock x:Name="textBlock"
                                               Text="{TemplateBinding Content}"
                                               FontWeight="{TemplateBinding FontWeight}"
                                               FontSize="{TemplateBinding FontSize}">
                                        <TextBlock.Foreground>
                                            <LinearGradientBrush x:Name="RainbowBrush"
                                                                 StartPoint="0,0.5"
                                                                 EndPoint="1,.5">
                                                <GradientStop x:Name="G1"
                                                              Offset="0"
                                                              Color="#65b849" />
                                                <GradientStop x:Name="G2"
                                                              Offset=".166"
                                                              Color="#65b849" />
                                                <GradientStop x:Name="G3"
                                                              Offset=".166"
                                                              Color="#f7b423" />
                                                <GradientStop x:Name="G4"
                                                              Offset=".3333"
                                                              Color="#f7b423" />
                                                <GradientStop x:Name="G5"
                                                              Offset="0.3333"
                                                              Color="#f58122" />
                                                <GradientStop x:Name="G6"
                                                              Offset="0.5"
                                                              Color="#f58122" />
                                                <GradientStop x:Name="G7"
                                                              Offset="0.5"
                                                              Color=" #f8f8f8" />
                                                <GradientStop x:Name="G8"
                                                              Offset="0.5"
                                                              Color=" #f8f8f8" />
                                                <GradientStop x:Name="G9"
                                                              Offset="0.50"
                                                              Color="#de3a3c" />
                                                <GradientStop x:Name="G10"
                                                              Offset="0.666"
                                                              Color="#de3a3c" />
                                                <GradientStop x:Name="G11"
                                                              Offset="0.666"
                                                              Color="#943f96" />
                                                <GradientStop x:Name="G12"
                                                              Offset="0.8633"
                                                              Color="#943f96" />
                                                <GradientStop x:Name="G13"
                                                              Offset="0.8633"
                                                              Color="#009fd9" />
                                                <GradientStop x:Name="G14"
                                                              Offset="01"
                                                              Color="#009fd9" />
                                            </LinearGradientBrush>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="EllipseStyle"
                   TargetType="Button">
                <Setter Property="Padding"
                        Value="8,4,8,4" />
                <Setter Property="HorizontalAlignment"
                        Value="Center" />
                <Setter Property="VerticalAlignment"
                        Value="Center" />
                <Setter Property="FontWeight"
                        Value="Normal" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid x:Name="RootGrid">
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualStateGroup.Transitions>
                                            <VisualTransition GeneratedDuration="0:0:1"
                                                              To="Normal">
                                                <Storyboard>
                                                    <DoubleAnimationUsingKeyFrames Storyboard.TargetName="EllipseProgressBehavior"
                                                                                   Storyboard.TargetProperty="Progress">
                                                        <EasingDoubleKeyFrame KeyTime="0:0:1"
                                                                              Value="0">
                                                            <EasingDoubleKeyFrame.EasingFunction>
                                                                <QuinticEase EasingMode="EaseOut" />
                                                            </EasingDoubleKeyFrame.EasingFunction>
                                                        </EasingDoubleKeyFrame>
                                                    </DoubleAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualTransition>
                                            <VisualTransition GeneratedDuration="0:0:1"
                                                              To="MouseOver">
                                                <Storyboard>
                                                    <DoubleAnimationUsingKeyFrames Storyboard.TargetName="EllipseProgressBehavior"
                                                                                   Storyboard.TargetProperty="Progress">
                                                        <EasingDoubleKeyFrame KeyTime="0:0:1"
                                                                              Value="100">
                                                            <EasingDoubleKeyFrame.EasingFunction>
                                                                <QuinticEase EasingMode="EaseOut" />
                                                            </EasingDoubleKeyFrame.EasingFunction>
                                                        </EasingDoubleKeyFrame>
                                                    </DoubleAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualTransition>

                                        </VisualStateGroup.Transitions>
                                        <VisualState x:Name="Normal" />

                                        <VisualState x:Name="MouseOver">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="EllipseProgressBehavior"
                                                                 Storyboard.TargetProperty="Progress"
                                                                 To="100" />
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="Pressed">
                                            <Storyboard>
                                                <ColorAnimation Storyboard.TargetName="PART_Ellipse"
                                                                Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)"
                                                                To="#90B0E0E6"
                                                                Duration="0:0:0.1"
                                                                AutoReverse="False" />
                                            </Storyboard>
                                        </VisualState>

                                        <VisualState x:Name="Disabled" />
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                                <ContentPresenter x:Name="ContentPresenter"
                                                  Margin="{TemplateBinding Padding}"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  Content="{TemplateBinding Content}"
                                                  ContentTemplate="{TemplateBinding ContentTemplate}" />

                                <Ellipse x:Name="PART_Ellipse"
                                         Fill="Transparent"
                                         Stroke="{TemplateBinding BorderBrush}"
                                         StrokeThickness="2">
                                    <interactivity:Interaction.Behaviors>
                                        <behaviors:ChangeAngleToEnterPointerBehavior />
                                        <behaviors:ProgressToEllipseBehavior x:Name="EllipseProgressBehavior" />
                                    </interactivity:Interaction.Behaviors>
                                </Ellipse>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Name="MainGrid"
          IsEnabled="{Binding IsUiEnabled}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="NavColumn"
                              Width="320" />
            <ColumnDefinition Width="1" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <ui:NavigationView x:Name="RootNavigationView"
                           PaneOpened="RootNavigationView_PaneOpened"
                           PaneClosed="RootNavigationView_PaneClosed"
                           Grid.Column="0"
                           IsPaneOpen="True"
                           OpenPaneLength="320"
                           PaneDisplayMode="Left"
                           IsBackButtonVisible="Collapsed"
                           PreviewMouseLeftButtonUp="RootNavigationView_OnPreviewMouseLeftButtonUp">

            <ui:NavigationView.Style>
                <Style TargetType="ui:NavigationView"
                       BasedOn="{StaticResource {x:Type ui:NavigationView}}">
                    <Setter Property="PaneHeader">
                        <Setter.Value>
                            <Border Margin="4,4,4,10"
                                    Background="SkyBlue"
                                    CornerRadius="8">
                                <TextBlock Padding="10"
                                           FontSize="20"
                                           FontWeight="Bold"
                                           TextAlignment="Center"
                                           Text="翻译工具箱" />
                            </Border>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsPaneOpen}"
                                     Value="False">
                            <Setter Property="PaneHeader"
                                    Value="{x:Null}" />
                        </DataTrigger>
                    </Style.Triggers>

                </Style>
            </ui:NavigationView.Style>

            <ui:NavigationView.MenuItems>

                <ui:NavigationViewItem Icon="{ui:SymbolIcon Translate24}"
                                       d:IsExpanded="True"
                                       Margin="-3,0,0,0"
                                       Style="{StaticResource HoverHighlightNavigationViewItemStyle}"
                                       IsExpanded="{Binding IsLanguageSettingsExpanded, Mode=TwoWay}">
                    <ui:NavigationViewItem.Content>
                        <TextBlock Text="翻译语言设置"
                                   FontSize="16"
                                   Margin="10,0,0,0"
                                   FontWeight="SemiBold"
                                   Foreground="#FF003366" />
                    </ui:NavigationViewItem.Content>
                    <ui:NavigationViewItem.MenuItems>
                        <StackPanel Margin="45, 10, 20, 10"
                                    PreviewMouseDown="SettingsPanel_PreviewMouseDown">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="源语言"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Top"
                                           Margin="0,0,0,5"
                                           Foreground="Black"
                                           Opacity="1" />
                                <TextBlock Grid.Column="1"
                                           Text="目标语言"
                                           Foreground="Black"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Top"
                                           Margin="0,0,0,5"
                                           Opacity="1" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <ComboBox Grid.Column="0"
                                          ItemsSource="{Binding SupportedLanguages}"
                                          DisplayMemberPath="DisplayName"
                                          SelectedValuePath="Value"
                                          SelectedValue="{Binding SourceLanguage}"
                                          Margin="0,0,5,0" />
                                <ComboBox Grid.Column="1"
                                          ItemsSource="{Binding SupportedLanguages}"
                                          DisplayMemberPath="DisplayName"
                                          SelectedValuePath="Value"
                                          SelectedValue="{Binding TargetLanguage}"
                                          Margin="5,0,0,0" />
                            </Grid>
                        </StackPanel>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

                <ui:NavigationViewItem Icon="{ui:SymbolIcon Key24}"
                                       d:IsExpanded="True"
                                       Margin="-3,0,0,0"
                                       Style="{StaticResource HoverHighlightNavigationViewItemStyle}"
                                       IsExpanded="{Binding IsApiSettingsExpanded, Mode=TwoWay}">
                    <ui:NavigationViewItem.Content>
                        <TextBlock Text="翻译接口设置"
                                   Margin="10,0,0,0"
                                   FontSize="16"
                                   Foreground="#FF003366"
                                   FontWeight="SemiBold" />
                    </ui:NavigationViewItem.Content>
                    <ui:NavigationViewItem.MenuItems>
                        <StackPanel Margin="45, 10, 20, 10"
                                    PreviewMouseDown="SettingsPanel_PreviewMouseDown">
                            <TextBlock Text="API 服务"
                                       Margin="0,0,0,5"
                                       Foreground="Black"
                                       Opacity="1" />
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ComboBox Grid.Column="0"
                                          ItemsSource="{Binding ApiServiceOptions}"
                                          DisplayMemberPath="DisplayName"
                                          SelectedItem="{Binding CurrentProvider, Mode=TwoWay}" />

                                <ui:Button Grid.Column="1"
                                           Command="{Binding ViewApiDocumentationCommand}"
                                           Icon="{ui:SymbolIcon BookOpenGlobe24}"
                                           Height="38"
                                           Padding="10,5"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Margin="8,0,0,0"
                                           ToolTip="查看当前API的帮助文档"
                                           ToolTipService.InitialShowDelay="200">
                                    <ui:Button.Style>
                                        <Style TargetType="ui:Button"
                                               BasedOn="{StaticResource {x:Type ui:Button}}">
                                            <Setter Property="IsEnabled"
                                                    Value="True" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Command.CanExecute}"
                                                             Value="True">
                                                    <Setter Property="IsEnabled"
                                                            Value="True" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ui:Button.Style>
                                </ui:Button>

                                <ui:Button Grid.Column="2"
                                           Command="{Binding ManageApiDefinitionsCommand}"
                                           Content="+"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Height="38"
                                           Width="38"
                                           ToolTip="新增自定义API服务"
                                           ToolTipService.InitialShowDelay="200"
                                           Padding="10,5"
                                           Margin="8,0,0,0" />
                            </Grid>

                            <StackPanel Margin="0,10,0,0"
                                        Visibility="{Binding IsUserIdEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="用户 ID"
                                           Opacity="0.8"
                                           Margin="0,0,0,5" />
                                <TextBox Text="{Binding CurrentProfile.UserId, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>

                            <StackPanel Margin="0,10,0,0"
                                        Visibility="{Binding IsApiKeyEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="API 密钥"
                                           Foreground="Black"
                                           Margin="0,0,0,5"
                                           Opacity="1" />
                                <TextBox Text="{Binding CurrentProfile.ApiKey, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>

                            <StackPanel Margin="0,10,0,0"
                                        Visibility="{Binding IsApiUrlEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="API URL"
                                           Margin="0,0,0,5"
                                           Foreground="Black"
                                           Opacity="1" />
                                <TextBox Text="{Binding CurrentProfile.ApiEndpoint, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>

                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10,8"
                                    Margin="0,10,0,0"
                                    Visibility="{Binding IsModelListEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="模型列表"
                                               FontWeight="Bold"
                                               Foreground="Black"
                                               FontSize="14"        
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,8" />

                                    <Grid>
                                        <ComboBox ItemsSource="{Binding ModelList}"
                                                  SelectedItem="{Binding SelectedModel}"
                                                  TextSearch.TextPath="Name"
                                                  FontSize="13"
                                                  Text="{Binding CurrentModelInput, UpdateSourceTrigger=PropertyChanged}"
                                                  IsEditable="True"
                                                  IsEnabled="{Binding IsModelListEnabled}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Name}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsFavorite}"
                                                                                 Value="True">
                                                                        <Setter Property="Background"
                                                                                Value="#E8F5E9" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>

                                        <TextBlock Text="当前API无需选择模型"
                                                   Foreground="LightGray"
                                                   FontStyle="Italic"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Visibility="{Binding IsModelListEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                                   IsHitTestVisible="False" />
                                    </Grid>
                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <ui:Button Grid.Column="0"
                                                   Content="管理模型列表"
                                                   Appearance="Dark"
                                                   Foreground="AliceBlue"
                                                   Margin="0,0,4,0"
                                                   Command="{Binding ManageModelsCommand}"
                                                   IsEnabled="{Binding IsModelListEnabled}" />
                                        <ui:Button Grid.Column="1"
                                                   Content="获取模型列表"
                                                   Margin="4,0,0,0"
                                                   Command="{Binding GetModelsCommand}"
                                                   IsEnabled="{Binding IsModelListEnabled}" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10,8"
                                    Margin="0,10,0,0"
                                    Visibility="{Binding IsBalanceFeatureEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="API 余额"
                                               Foreground="Black"
                                               FontWeight="Bold"
                                               FontSize="14"
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,8" />

                                    <Grid>
                                        <TextBox Text="{Binding LastBalanceDisplay}"
                                                 IsReadOnly="True"
                                                 TextWrapping="Wrap"
                                                 IsEnabled="{Binding IsBalanceFeatureEnabled}"
                                                 VerticalContentAlignment="Center"
                                                 Padding="5">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox"
                                                       BasedOn="{StaticResource {x:Type TextBox}}">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsEnabled"
                                                                 Value="False">
                                                            <Setter Property="Foreground"
                                                                    Value="Transparent" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        <TextBlock Text="当前API不支持余额查询"
                                                   Foreground="LightGray"
                                                   FontStyle="Italic"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Visibility="{Binding IsBalanceFeatureEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                                   IsHitTestVisible="False" />
                                    </Grid>
                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <ui:Button Grid.Column="0"
                                                   Content="用户历史信息"
                                                   Margin="0,0,4,0"
                                                   Appearance="Dark"
                                                   Foreground="AliceBlue"
                                                   Command="{Binding ViewHistoryCommand}"
                                                   IsEnabled="{Binding IsBalanceFeatureEnabled}" />
                                        <ui:Button Grid.Column="1"
                                                   Content="获取用户信息"
                                                   Margin="5,0,0,0"
                                                   Command="{Binding GetBalanceCommand}"
                                                   IsEnabled="{Binding IsBalanceFeatureEnabled}" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10,8"
                                    Margin="0,10,0,0"
                                    Visibility="{Binding IsPromptSupported, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="提示词"
                                               FontWeight="Bold"
                                               FontSize="14"
                                               Foreground="Black"
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,8" />

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0"
                                                   Text="提示词模板"
                                                   FontWeight="Normal"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,10,0" />
                                        <ComboBox Grid.Column="1"
                                                  ItemsSource="{Binding PromptTemplateDisplayNames}"
                                                  DisplayMemberPath="Value"
                                                  FontWeight="Regular"
                                                  SelectedValuePath="Key"
                                                  SelectedValue="{Binding SelectedPromptTemplate}" />
                                    </Grid>

                                    <Grid Margin="0,8,0,0">
                                        <ui:TextBox Text="{Binding FormattedDisplayedPrompt, Mode=OneWay}"
                                                    IsReadOnly="{Binding IsPromptBoxReadOnly}"
                                                    TextWrapping="Wrap"
                                                    AcceptsReturn="True"
                                                    FontWeight="Regular"
                                                    VerticalScrollBarVisibility="Auto"
                                                    MinHeight="120" />
                                        <TextBlock Text="此接口为专业翻译接口，无需提示词"
                                                   Foreground="LightGray"
                                                   FontStyle="Italic"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Visibility="{Binding CurrentProvider.IsPromptSupported, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                                   IsHitTestVisible="False" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                        </StackPanel>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

                <ui:NavigationViewItem Icon="{ui:SymbolIcon Settings24}"
                                       d:IsExpanded="True"
                                       Margin="-3,0,0,0"
                                       Style="{StaticResource HoverHighlightNavigationViewItemStyle}"
                                       IsExpanded="{Binding IsFunctionSettingsExpanded, Mode=TwoWay}">
                    <ui:NavigationViewItem.Content>
                        <TextBlock Text="功能设置"
                                   Margin="10,0,0,0"
                                   FontSize="16"
                                   Foreground="#FF003366"
                                   FontWeight="SemiBold" />
                    </ui:NavigationViewItem.Content>
                    <ui:NavigationViewItem.MenuItems>
                        <StackPanel Margin="45, 10, 20, 10"
                                    PreviewMouseDown="SettingsPanel_PreviewMouseDown">

                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10,8">
                                <StackPanel>
                                    <TextBlock Text="实时排版功能"
                                               FontWeight="Bold"
                                               Foreground="Black"
                                               FontSize="14"
                                               HorizontalAlignment="Center" />
                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <ui:ToggleSwitch x:Name="LiveLayoutToggleSwitch"
                                                         Grid.Column="0"
                                                         VerticalAlignment="Center"
                                                         IsChecked="{Binding IsLiveLayoutEnabled}"
                                                         OnContent="打开"
                                                         OffContent="关闭" />

                                        <TextBlock Grid.Column="1"
                                                   VerticalAlignment="Center"
                                                   Text="行间距:"
                                                   Margin="15,0,5,0"
                                                   FontWeight="Regular"
                                                   Opacity="1"
                                                   Visibility="{Binding IsLiveLayoutEnabled, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <ComboBox Grid.Column="2"
                                                  VerticalAlignment="Center"
                                                  ItemsSource="{Binding LineSpacingOptions}"
                                                  Text="{Binding CurrentLineSpacingInput, UpdateSourceTrigger=LostFocus}"
                                                  IsEditable="True"
                                                  IsEnabled="{Binding IsLiveLayoutEnabled}"
                                                  Visibility="{Binding IsLiveLayoutEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">

                                            <ComboBox.Style>
                                                <Style TargetType="ComboBox"
                                                       BasedOn="{StaticResource {x:Type ComboBox}}">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsEnabled"
                                                                 Value="False">
                                                            <Setter Property="Foreground"
                                                                    Value="Transparent" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ComboBox.Style>
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   Text="{Binding}"
                                                                   VerticalAlignment="Center"
                                                                   Padding="3,0,0,0" />
                                                        <ui:Button Grid.Column="1"
                                                                   Command="{Binding DataContext.DeleteLineSpacingOptionCommand, RelativeSource={RelativeSource AncestorType=ComboBox}}"
                                                                   CommandParameter="{Binding}"
                                                                   Appearance="Transparent"
                                                                   FontSize="16"
                                                                   FontWeight="Bold"
                                                                   Padding="8,0">
                                                            <ui:Button.Style>
                                                                <Style TargetType="ui:Button"
                                                                       BasedOn="{StaticResource {x:Type ui:Button}}">
                                                                    <Setter Property="Content"
                                                                            Value="×" />
                                                                    <Setter Property="Foreground"
                                                                            Value="Gray" />
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding}"
                                                                                     Value="不指定">
                                                                            <Setter Property="Visibility"
                                                                                    Value="Collapsed" />
                                                                        </DataTrigger>
                                                                        <Trigger Property="IsMouseOver"
                                                                                 Value="True">
                                                                            <Setter Property="Foreground"
                                                                                    Value="Red" />
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </ui:Button.Style>
                                                        </ui:Button>
                                                    </Grid>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </Grid>
                                    <Grid Margin="0,8,0,0"
                                          Visibility="{Binding IsLiveLayoutEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <ui:ToggleSwitch IsChecked="{Binding AddUnderlineAfterSmartLayout}"
                                                         OnContent="排版后增加下划线"
                                                         OffContent="排版后不增加下划线"
                                                         HorizontalAlignment="Left" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10,8"
                                    Margin="0,15,0,0">
                                <StackPanel>
                                    <TextBlock Text="原文发送模式"
                                               Foreground="Black"
                                               FontWeight="Bold"
                                               FontSize="14"
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,8" />

                                    <RadioButton Content="每句话发起一次请求"
                                                 GroupName="SendingMode"
                                                 IsChecked="{Binding SendingMode, ConverterParameter={x:Static settings:PromptSendingMode.PerSentence}, Converter={StaticResource EnumToBooleanConverter}}" />

                                    <RadioButton Content="多句话合并为一次请求"
                                                 GroupName="SendingMode"
                                                 Margin="0,5,0,0"
                                                 IsChecked="{Binding SendingMode, ConverterParameter={x:Static settings:PromptSendingMode.Once}, Converter={StaticResource EnumToBooleanConverter}}" />

                                    <StackPanel Margin="20,8,0,0"
                                                Visibility="{Binding IsCharLimitVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0"
                                                       Text="最大单次发送字符"
                                                       FontStyle="Normal"
                                                       FontWeight="Regular"
                                                       VerticalAlignment="Center"
                                                       Margin="-15,0,10,0" />
                                            <ComboBox Grid.Column="1"
                                                      VerticalAlignment="Center"
                                                      Margin="-5,0,0,0"
                                                      ItemsSource="{Binding CharLimitOptions}"
                                                      Text="{Binding MaxCharsPerBatch, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"
                                                      IsEditable="True"
                                                      Width="100"
                                                      HorizontalAlignment="Left" />
                                        </Grid>
                                        <Slider Minimum="100"
                                                Maximum="3000"
                                                TickFrequency="10"
                                                IsSnapToTickEnabled="True"
                                                Value="{Binding MaxCharsPerBatch, Mode=TwoWay}"
                                                Margin="-10,5,10,0" />
                                    </StackPanel>

                                    <StackPanel Margin="20,8,0,0"
                                                Visibility="{Binding IsTokenLimitVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0"
                                                       Text="最大单次发送Token"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Regular"
                                                       FontStyle="Normal"
                                                       Margin="-15,0,10,0" />
                                            <ComboBox Grid.Column="1"
                                                      VerticalAlignment="Center"
                                                      ItemsSource="{Binding TokenLimitOptions}"
                                                      Text="{Binding MaxTokensPerBatch, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"
                                                      IsEditable="True"
                                                      Margin="-8,0,0,0"
                                                      Width="100"
                                                      HorizontalAlignment="Left" />
                                        </Grid>
                                        <Slider Minimum="1000"
                                                Maximum="10000"
                                                TickFrequency="100"
                                                IsSnapToTickEnabled="True"
                                                Value="{Binding MaxTokensPerBatch, Mode=TwoWay}"
                                                Margin="-10,5,10,0" />
                                    </StackPanel>

                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10,8"
                                    Margin="0,15,0,0">
                                <StackPanel>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="1"
                                                    VerticalAlignment="Center">
                                            <TextBlock Text="段落合并相似度阈值"
                                                       FontWeight="Bold"
                                                       Foreground="Black"
                                                       FontSize="14"
                                                       HorizontalAlignment="Center" />

                                        </StackPanel>

                                        <ui:SymbolIcon Grid.Column="2"
                                                       Symbol="Info24"
                                                       FontSize="14"
                                                       Margin="5,0,0,0"
                                                       HorizontalAlignment="Left"
                                                       VerticalAlignment="Center"
                                                       ToolTipService.InitialShowDelay="100">
                                            <ui:SymbolIcon.ToolTip>
                                                <ToolTip>
                                                    <TextBlock TextWrapping="Wrap"
                                                               MaxWidth="250">
                            当一整句话在图纸中按多行排布的时候，程序会智能识别这几行字应该归并为多少个并列项。当多行字的结构相似度大于设定值的时候，会将它们识别为并列项。
                                                    </TextBlock>
                                                </ToolTip>
                                            </ui:SymbolIcon.ToolTip>
                                        </ui:SymbolIcon>
                                    </Grid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Slider Grid.Column="0"
                                                Minimum="0.1"
                                                Maximum="0.9"
                                                TickFrequency="0.01"
                                                IsSnapToTickEnabled="True"
                                                Value="{Binding SimilarityThreshold, Mode=TwoWay}"
                                                Margin="0,0,10,0"
                                                VerticalAlignment="Center" />
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding SimilarityThreshold, Mode=TwoWay, StringFormat=F2}"
                                                 Width="70"
                                                 TextAlignment="Center"
                                                 VerticalContentAlignment="Center" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10,8"
                                    Margin="0,15,0,0">
                                <StackPanel>
                                    <TextBlock Text="多线程并发翻译"
                                               FontWeight="Bold"
                                               Foreground="Black"
                                               FontSize="14"
                                               HorizontalAlignment="Center" />
                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <ui:ToggleSwitch x:Name="MultiThreadingToggleSwitch"
                                                         Grid.Column="0"
                                                         VerticalAlignment="Center"
                                                         IsChecked="{Binding IsMultiThreadingEnabled}"
                                                         OnContent="打开"
                                                         OffContent="关闭" />

                                        <TextBlock Grid.Column="1"
                                                   VerticalAlignment="Center"
                                                   Text="最大并发量:"
                                                   Margin="15,0,5,0"
                                                   FontWeight="Regular"
                                                   Opacity="1"
                                                   Visibility="{Binding IsMultiThreadingEnabled, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <ComboBox Grid.Column="2"
                                                  VerticalAlignment="Center"
                                                  ItemsSource="{Binding ConcurrencyLevelOptions}"
                                                  Text="{Binding CurrentConcurrencyLevelInput, UpdateSourceTrigger=LostFocus}"
                                                  IsEditable="True"
                                                  IsEnabled="{Binding IsMultiThreadingEnabled}"
                                                  Visibility="{Binding IsMultiThreadingEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">

                                            <ComboBox.Style>
                                                <Style TargetType="ComboBox"
                                                       BasedOn="{StaticResource {x:Type ComboBox}}">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsEnabled"
                                                                 Value="False">
                                                            <Setter Property="Foreground"
                                                                    Value="Transparent" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ComboBox.Style>
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="{Binding}" />
                                                        <ui:Button Grid.Column="1"
                                                                   Command="{Binding DataContext.DeleteConcurrencyOptionCommand, RelativeSource={RelativeSource AncestorType=ComboBox}}"
                                                                   CommandParameter="{Binding}"
                                                                   Appearance="Transparent"
                                                                   FontSize="14"
                                                                   FontWeight="Bold"
                                                                   Padding="8,0">
                                                            <ui:Button.Style>
                                                                <Style TargetType="ui:Button"
                                                                       BasedOn="{StaticResource {x:Type ui:Button}}">
                                                                    <Setter Property="Content"
                                                                            Value="×" />
                                                                    <Setter Property="Foreground"
                                                                            Value="Gray" />
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding}"
                                                                                     Value="2">
                                                                            <Setter Property="Visibility"
                                                                                    Value="Collapsed" />
                                                                        </DataTrigger>
                                                                        <Trigger Property="IsMouseOver"
                                                                                 Value="True">
                                                                            <Setter Property="Foreground"
                                                                                    Value="Red" />
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </ui:Button.Style>
                                                        </ui:Button>
                                                    </Grid>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource SystemAccentColorLight3Brush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="0,10"
                                    Margin="0,15,0,10">
                                <StackPanel>
                                    <TextBlock Text="用户配置"
                                               FontWeight="Bold"
                                               Foreground="Black"
                                               FontSize="14"
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,8" />
                                    
                                    <Grid Margin="0,10,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <ui:Button Content="使用记录"
                                                   Grid.Column="0"
                                                   Command="{Binding ViewUsageHistoryCommand}"
                                                   Style="{StaticResource RainbowButtonStyle}"
                                                   FontSize="14"
                                                   Margin="1,0,5,0"
                                                   FontWeight="Bold"
                                                   Padding="10,5" />
                                        <ui:Button Content="导出设置"
                                                   Grid.Column="1"
                                                   Command="{Binding ExportSettingsCommand}"
                                                   Style="{StaticResource RainbowButtonStyle}"
                                                   FontSize="14"
                                                   Margin="0,0,0,0"
                                                   FontWeight="Bold"
                                                   Padding="10,5" />
                                        <ui:Button Content="导入设置"
                                                   Grid.Column="2"
                                                   Command="{Binding ImportSettingsCommand}"
                                                   Style="{StaticResource RainbowButtonStyle}"
                                                   FontSize="14"
                                                   Margin="5,0,-5,0"
                                                   FontWeight="Bold"
                                                   Padding="10,5" />
                                        <!--ui:Button Content="导入"
                                                   Grid.Column="0"
                                                   Style="{StaticResource EllipseStyle}"
                                                   FontSize="14"
                                                   Command="{Binding ImportSettingsCommand}"
                                                   BorderBrush="LightSeaGreen"
                                                   Width="50"
                                                   Height="50"
                                                   FontWeight="Bold"
                                                   Padding="10,5"
                                                   Margin="0,10,0,0" /-->
                                        <!--ui:Button Content="导出"
                                                   Style="{StaticResource EllipseStyle}"
                                                   FontSize="14"
                                                   Grid.Column="1"
                                                   Command="{Binding ExportSettingsCommand}"
                                                   BorderBrush="LightSeaGreen"
                                                   Width="50"
                                                   Height="50"
                                                   FontWeight="Bold"
                                                   Padding="10,5"
                                                   Margin="0,10,0,0" /-->
                                    </Grid>
                                   

                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

            </ui:NavigationView.MenuItems>
        </ui:NavigationView>

        <Border Grid.Column="1"
                Background="{DynamicResource ControlStrokeColorDefaultBrush}" />

        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <RowDefinition Height="2.5*" />
                <RowDefinition Height="5" />
                <RowDefinition Height="1*" />
            </Grid.RowDefinitions>
            <ui:TitleBar Grid.Row="0"
                         CanMaximize="True" />
            <Grid Grid.Row="1"
                  Margin="20,0,20,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <DataGrid Name="dataGridBlocks"
                          Grid.Row="0"
                          ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyleWithBorders}"
                          ItemsSource="{Binding TextBlockList}"
                          GridLinesVisibility="All"
                          HeadersVisibility="All"
                          SnapsToDevicePixels="True"
                          MouseDoubleClick="DataGrid_MouseDoubleClick"
                          AutoGenerateColumns="False"
                          PreviewMouseWheel="DataGrid_PreviewMouseWheel">
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background"
                                    Value="{Binding RowBackground, UpdateSourceTrigger=PropertyChanged}" />
                        </Style>
                    </DataGrid.RowStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="段落"
                                            Binding="{Binding Id}"
                                            Width="60"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment"
                                            Value="Center" />
                                    <Setter Property="VerticalAlignment"
                                            Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="编号"
                                            Binding="{Binding Character}"
                                            Width="60"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment"
                                            Value="Center" />
                                    <Setter Property="VerticalAlignment"
                                            Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="原文"
                                                Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding OriginalText}"
                                               TextWrapping="Wrap"
                                               Margin="5" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding OriginalText, Mode=OneWay}"
                                             TextWrapping="Wrap"
                                             AcceptsReturn="True"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="5"
                                             IsReadOnly="True" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="译文"
                                                Width="*"
                                                IsReadOnly="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding TranslatedText}"
                                               TextWrapping="Wrap"
                                               Margin="5"
                                               Padding="2" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>

                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding TranslatedText, UpdateSourceTrigger=PropertyChanged}"
                                             TextWrapping="Wrap"
                                             AcceptsReturn="True"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="5" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                <Grid Grid.Row="1"
                      Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left">
                        <ui:Button Content="合并"
                                   Margin="0,0,10,0"
                                   Command="{Binding MergeCommand}"
                                   CommandParameter="{Binding ElementName=dataGridBlocks, Path=SelectedItems}" />
                        <ui:Button Content="拆分"
                                   Margin="0,0,10,0"
                                   Command="{Binding SplitCommand}"
                                   CommandParameter="{Binding ElementName=dataGridBlocks, Path=SelectedItem}" />

                        <ui:Button Content="删除"
                                   Appearance="Danger"
                                   Command="{Binding DeleteCommand}"
                                   Margin="0,0,10,0"
                                   CommandParameter="{Binding ElementName=dataGridBlocks, Path=SelectedItems}" />
                        <ui:Button Content="重置"
                                   Command="{Binding ResetCommand}"
                                   Margin="0,0,10,0"
                                   Appearance="Secondary" />
                        <ui:Button Content="错误项重翻译"
                                   Appearance="Secondary"
                                   Icon="ArrowSync24"
                                   Command="{Binding RetranslateFailedCommand}" />
                    </StackPanel>
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <ui:Button Content="选择CAD文字"
                                   Appearance="Primary"
                                   Icon="{ui:SymbolIcon Symbol=ScanType24 }"
                                   Command="{Binding SelectTextCommand}"
                                   CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" />
                        <ui:Button Content="一键翻译"
                                   Margin="10,0,10,0"
                                   Icon="{ui:SymbolIcon Symbol=BookSearch24,Filled=True}"
                                   Appearance="Caution"
                                   Command="{Binding TranslateCommand}"
                                   Visibility="{Binding IsTranslating, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />

                        <ui:Button Content="取消翻译"
                                   Margin="10,0,10,0"
                                   d:Visibility="Collapsed"
                                   Icon="{ui:SymbolIcon Symbol=DismissCircle24,Filled=True}"
                                   Appearance="Danger"
                                   Command="{Binding CancelTranslationCommand}"
                                   Visibility="{Binding IsTranslating, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        <ui:Button Content="应用翻译"
                                   Icon="{ui:SymbolIcon Symbol=Pen32,Filled=False}"
                                   Appearance="Success"
                                   Command="{Binding ApplyToCadCommand}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Grid>
            </Grid>

            <GridSplitter Grid.Row="2"
                          Height="5"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Center"
                          Background="{DynamicResource ControlElevationBorderBrush}" />

            <Border Grid.Row="3"
                    Padding="15,10"
                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    BorderThickness="1,1,1,1"
                    BorderBrush="{DynamicResource ControlElevationBorderBrush}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="220" />
                    </Grid.ColumnDefinitions>

                    <ScrollViewer Name="LogScrollViewer"
                                  Grid.Column="0"
                                  VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding StatusLog}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding Path=., Mode=OneWay}"
                                             TextWrapping="Wrap"
                                             IsReadOnly="True"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="0,0,0,2" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>

                    <Border Grid.Column="1"
                            Background="{DynamicResource ControlElevationBorderBrush}"
                            Width="1"
                            Margin="10,0" />

                    <Grid Grid.Column="2"
                          VerticalAlignment="Stretch">
                        <Grid Grid.RowSpan="2"
                              VerticalAlignment="Center"
                              Width="150"
                              Height="150"
                              HorizontalAlignment="Center"
                              Margin="5">

                            <Grid>
                                <Grid.Clip>
                                    <EllipseGeometry Center="75,75"
                                                     RadiusX="75"
                                                     RadiusY="75" />
                                </Grid.Clip>
                                <controls:WaveProgressBar x:Name="MyWaveProgressBar"
                                                          Progress="{Binding ProgressValue, Converter={StaticResource ProgressConverter}}" />
                            </Grid>

                            <!--Ellipse Stroke="WhiteSmoke"
                                     StrokeDashCap="Round"
                                     Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                                     StrokeThickness="12">
                                <interactivity:Interaction.Behaviors>
                                    <behaviors:EllipseProgressBehavior EndAngle="150"
                                                                       Progress="100"
                                                                       StartAngle="-150" />
                                </interactivity:Interaction.Behaviors>
                            </Ellipse>
                            <Ellipse Margin="4"
                                     Stroke="LightBlue"
                                     StrokeDashCap="Round"
                                     Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                                     StrokeThickness="4">
                                <interactivity:Interaction.Behaviors>
                                    <behaviors:EllipseProgressBehavior Progress="{Binding ProgressValue}"
                                                                       EndAngle="150"
                                                                       StartAngle="-150"
                                                                       AnimationDuration="0:0:1" />
                                </interactivity:Interaction.Behaviors>
                            </Ellipse-->

                            <Grid>
                                <Grid>
                                    <Grid.Effect>
                                        <effects:GlowEffect Amount="8" />
                                    </Grid.Effect>
                                    <TextBlock Text="{Binding ElementName=MyWaveProgressBar, Path=DisplayedProgress, StringFormat={}{0:F0}%}"
                                               FontSize="30"
                                               FontWeight="Bold"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                        <TextBlock.Foreground>
                                            <Binding ElementName="MyWaveProgressBar"
                                                     Path="Progress"
                                                     Converter="{StaticResource ProgressToGlowColorConverter}" />
                                        </TextBlock.Foreground>
                                        <TextBlock.Effect>
                                            <BlurEffect Radius="20"
                                                        RenderingBias="Quality" />
                                        </TextBlock.Effect>
                                    </TextBlock>
                                </Grid>
                                <TextBlock Text="{Binding ElementName=MyWaveProgressBar, Path=DisplayedProgress, StringFormat={}{0:F0}%}"
                                           Foreground="#ebfeff"
                                           FontSize="30"
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Grid>
                    </Grid>

                </Grid>
            </Border>
        </Grid>
    </Grid>
</ui:FluentWindow>