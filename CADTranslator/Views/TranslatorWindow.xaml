<ui:FluentWindow x:Class="CADTranslator.Views.TranslatorWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:vm="clr-namespace:CADTranslator.ViewModels"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:Tools="clr-namespace:CADTranslator.Tools.UI"
                 mc:Ignorable="d"
                 d:DataContext="{d:DesignInstance Type=vm:TranslatorViewModel,IsDesignTimeCreatable=False}"
                 Title="CAD Translator Toolbox"
                 Height="725"
                 Width="1080"
                 WindowStartupLocation="CenterScreen"
                 WindowBackdropType="Mica"
                 d:DesignHeight="1200"
                 ExtendsContentIntoTitleBar="True">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ui:ThemesDictionary Theme="Light" />
                <ui:ControlsDictionary />
            </ResourceDictionary.MergedDictionaries>
            <Tools:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <Tools:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
            <Style TargetType="{x:Type DataGridCell}"
                   BasedOn="{StaticResource {x:Type DataGridCell}}">
                <Setter Property="SnapsToDevicePixels"
                        Value="True" />
                <Setter Property="BorderThickness"
                        Value="1 1 1 1" />
                <Setter Property="BorderBrush"
                        Value="LightBlue" />
            </Style>
            <Style x:Key="DataGridColumnHeaderStyleWithBorders"
                   TargetType="{x:Type DataGridColumnHeader}"
                   BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                <Setter Property="SnapsToDevicePixels"
                        Value="True" />
                <Setter Property="BorderBrush"
                        Value="LightBlue" />
                <Setter Property="BorderThickness"
                        Value="1,1,1,1" />
                <Setter Property="FontSize"
                        Value="20" />
                <Setter Property="HorizontalContentAlignment"
                        Value="Center" />
                <Setter Property="VerticalContentAlignment"
                        Value="Center" />
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Name="MainGrid"
          IsEnabled="{Binding IsUiEnabled}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0"
                Background="{DynamicResource ApplicationBackgroundBrush}"
                CornerRadius="8,0,0,8"
                BorderThickness="0,0,1,0"
                BorderBrush="{DynamicResource ControlElevationBorderBrush}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <Border Padding="5"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            Margin="10,10,20,0"
                            Background="SkyBlue"
                            CornerRadius="10">

                        <TextBlock Text="翻译工具箱"
                                   FontSize="24"
                                   Padding="10"
                                   FontWeight="Bold"
                                   TextAlignment="Center" />
                    </Border>
                    <StackPanel Margin="20,15,20,0">
                        <Border Padding="5,5,5,5"
                                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                Margin="-5,0,0,0"
                                Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                CornerRadius="10">
                            <StackPanel>
                                <TextBlock Text="翻译语言设置"
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           FontSize="16"
                                           Margin="0,0,0,10" />

                                <Grid Margin="0,0,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="源语言"
                                               Grid.Column="0"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Top"
                                               Margin="0,0,0,5"
                                               Opacity="0.8" />
                                    <TextBlock Text="目标语言"
                                               Margin="0,0,0,5"
                                               Grid.Column="1"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Top"
                                               Opacity="0.8" />
                                </Grid>
                                <Grid Margin="0,0,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <ComboBox ItemsSource="{Binding SupportedLanguages}"
                                              DisplayMemberPath="DisplayName"
                                              Grid.Column="0"
                                              Margin="0,0,5,0"
                                              SelectedValuePath="Value"
                                              SelectedValue="{Binding SourceLanguage}" />
                                    <ComboBox ItemsSource="{Binding SupportedLanguages}"
                                              DisplayMemberPath="DisplayName"
                                              SelectedValuePath="Value"
                                              Margin="5,0,5,0"
                                              Grid.Column="1"
                                              SelectedValue="{Binding TargetLanguage}" />
                                </Grid>
                            </StackPanel>
                        </Border>


                        <TextBlock Text="API 设置"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   FontSize="16"
                                   Margin="0,15,0,0" />
                        <TextBlock Text="API 服务"
                                   Margin="0,0,0,0"
                                   Opacity="0.8" />
                        <ComboBox ItemsSource="{Binding ApiServiceOptions}"
                                  DisplayMemberPath="DisplayName"
                                  SelectedItem="{Binding CurrentProvider, Mode=TwoWay}" />
                        <ui:Button Content="新增/管理API..."
                                   Command="{Binding ManageApiDefinitionsCommand}"
                                   Icon="Add24"
                                   Appearance="Transparent"
                                   HorizontalAlignment="Right"
                                   Margin="0,5,0,0" />
                        <TextBlock Text="用户 ID"
                                   Margin="0,10,0,5"
                                   Opacity="0.8" />
                        <Grid>
                            <TextBox Text="{Binding CurrentProfile.UserId, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding IsUserIdEnabled}" />
                            <TextBlock Text="当前API无需设置该内容"
                                       Foreground="LightGray"
                                       FontStyle="Italic"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsUserIdEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                       IsHitTestVisible="False" />
                        </Grid>
                        <TextBlock Text="API 密钥"
                                   Margin="0,10,0,5"
                                   Opacity="0.8" />
                        <Grid>
                            <TextBox Text="{Binding CurrentProfile.ApiKey, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding IsApiKeyEnabled}" />
                            <TextBlock Text="当前API无需设置该内容"
                                       Foreground="LightGray"
                                       FontStyle="Italic"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsApiKeyEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                       IsHitTestVisible="False" />
                        </Grid>
                        <TextBlock Text="API URL"
                                   Margin="0,10,0,5"
                                   Opacity="0.8" />
                        <Grid>
                            <TextBox Text="{Binding CurrentProfile.ApiEndpoint, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding IsApiUrlEnabled}" />
                            <TextBlock Text="当前API无需设置该内容"
                                       Foreground="LightGray"
                                       FontStyle="Italic"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsApiUrlEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                       IsHitTestVisible="False" />
                        </Grid>
                        <TextBlock Text="模型列表"
                                   Margin="0,10,0,5"
                                   Opacity="0.8" />
                        <Border Padding="5"
                                Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                CornerRadius="4">
                            <StackPanel>
                                <ComboBox ItemsSource="{Binding ModelList}"
                                          SelectedValue="{Binding CurrentProfile.LastSelectedModel}"
                                          Text="{Binding CurrentModelInput, UpdateSourceTrigger=PropertyChanged}"
                                          IsEditable="True"
                                          IsEnabled="{Binding IsModelListEnabled}" />
                                <Grid Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <ui:Button Grid.Column="0"
                                               Content="管理模型列表"
                                               Appearance="Dark"
                                               Margin="0,0,0,0"
                                               Command="{Binding ManageModelsCommand}"
                                               IsEnabled="{Binding IsModelListEnabled}" />
                                    <ui:Button Grid.Column="1"
                                               Content="获取模型列表"
                                               Margin="4,0,0,0"
                                               Command="{Binding GetModelsCommand}"
                                               IsEnabled="{Binding IsModelListEnabled}" />
                                </Grid>
                            </StackPanel>
                        </Border>
                        <TextBlock Text="API 余额"
                                   Margin="0,10,0,10" />

                        <Grid Margin="0,0,0,10">
                            <TextBox Text="{Binding LastBalanceDisplay}"
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     IsEnabled="{Binding IsBalanceFeatureEnabled}"
                                     VerticalContentAlignment="Center"
                                     Padding="5">
                                <TextBox.Style>
                                    <Style TargetType="TextBox"
                                           BasedOn="{StaticResource {x:Type TextBox}}">
                                        <Style.Triggers>
                                            <Trigger Property="IsEnabled"
                                                     Value="False">
                                                <Setter Property="Foreground"
                                                        Value="Transparent" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBox.Style>
                            </TextBox>

                            <TextBlock Text="当前API不支持余额查询"
                                       Foreground="LightGray"
                                       FontStyle="Italic"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsBalanceFeatureEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                       IsHitTestVisible="False" />
                        </Grid>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <ui:Button Grid.Column="0"
                                       Content="历史记录"
                                       Margin="4,0,10,0"
                                       Appearance="Dark"
                                       Command="{Binding ViewHistoryCommand}"
                                       IsEnabled="{Binding IsBalanceFeatureEnabled}" />

                            <ui:Button Grid.Column="1"
                                       Content="获取余额"
                                       Margin="10,0,0,0"
                                       Command="{Binding GetBalanceCommand}"
                                       IsEnabled="{Binding IsBalanceFeatureEnabled}" />

                        </Grid>
                        <TextBlock Text="提示词(如不是必要，请不要填写)"
                                   Margin="0,10,0,5"
                                   Opacity="0.8" />
                        <TextBox Text="{Binding GlobalPrompt, UpdateSourceTrigger=PropertyChanged}"
                                 MinHeight="100"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto" />
                        <TextBlock Text="高级设置"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   FontSize="16"
                                   Margin="0,15,0,0" />
                        <TextBlock Text="段落合并灵敏度 (值越高越容易合并)"
                                   Margin="0,10,0,5"
                                   Opacity="0.8" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Slider Grid.Column="0"
                                    Minimum="0.1"
                                    Maximum="0.9"
                                    TickFrequency="0.05"
                                    IsSnapToTickEnabled="True"
                                    Value="{Binding SimilarityThreshold, Mode=TwoWay}"
                                    Margin="0,0,10,0"
                                    VerticalAlignment="Center"
                                    Cursor="" />

                            <ui:NumberBox Grid.Column="1"
                                          Value="{Binding SimilarityThreshold, Mode=TwoWay}"
                                          Width="100"
                                          SmallChange="0.05"
                                          LargeChange="0.2" />
                        </Grid>

                        <TextBlock Text="多线程设置"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   FontSize="16"
                                   Margin="0,15,0,0" />
                        <ui:ToggleSwitch 
                                         OnContent="开启多线程并发"
                                         OffContent="关闭多线程并发"
                                         IsChecked="{Binding IsMultiThreadingEnabled}"
                                         Margin="0,10,0,5" />
                        <TextBlock Text="最大并发量"
                                   Margin="0,0,0,5"
                                   Opacity="0.8" />
                        <Grid>
                            <ComboBox ItemsSource="{Binding ConcurrencyLevelOptions}"
                                      Text="{Binding CurrentConcurrencyLevelInput, UpdateSourceTrigger=LostFocus}"
                                      IsEditable="True"
                                      Margin="0,0,0,50"
                                      IsEnabled="{Binding IsMultiThreadingEnabled}">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox"
                                           BasedOn="{StaticResource {x:Type ComboBox}}">
                                        <Style.Triggers>
                                            <Trigger Property="IsEnabled"
                                                     Value="False">
                                                <Setter Property="Foreground"
                                                        Value="Transparent" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       VerticalAlignment="Center"
                                                       Text="{Binding}" />

                                            <ui:Button Grid.Column="1"
                                                       Command="{Binding DataContext.DeleteConcurrencyOptionCommand, RelativeSource={RelativeSource AncestorType=ComboBox}}"
                                                       CommandParameter="{Binding}"
                                                       Appearance="Transparent"
                                                       FontSize="14"
                                                       FontWeight="Bold"
                                                       Padding="8,0">
                                                <ui:Button.Style>
                                                    <Style TargetType="ui:Button"
                                                           BasedOn="{StaticResource {x:Type ui:Button}}">
                                                        <Setter Property="Content"
                                                                Value="×" />
                                                        <Setter Property="Foreground"
                                                                Value="Gray" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding}"
                                                                         Value="2">
                                                                <Setter Property="Visibility"
                                                                        Value="Collapsed" />
                                                            </DataTrigger>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Foreground"
                                                                        Value="Red" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ui:Button.Style>
                                            </ui:Button>
                                        </Grid>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <TextBlock Text="多线程未采用"
                                       Foreground="LightGray"
                                       FontStyle="Italic"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,50"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsMultiThreadingEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                       IsHitTestVisible="False" />
                        </Grid>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>

        

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <RowDefinition Height="2.5*" />
                <RowDefinition Height="5" />
                <RowDefinition Height="1*" />
            </Grid.RowDefinitions>
            <ui:TitleBar Grid.Row="0"
                         CanMaximize="True" />
            <Grid Grid.Row="1"
                  Margin="20,0,20,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <DataGrid Name="dataGridBlocks"
                          Grid.Row="0"
                          ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyleWithBorders}"
                          ItemsSource="{Binding TextBlockList}"
                          GridLinesVisibility="All"
                          HeadersVisibility="All"
                          SnapsToDevicePixels="True"
                          MouseDoubleClick="DataGrid_MouseDoubleClick"
                          AutoGenerateColumns="False"
                          PreviewMouseWheel="DataGrid_PreviewMouseWheel">
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background"
                                    Value="{Binding RowBackground, UpdateSourceTrigger=PropertyChanged}" />
                        </Style>
                    </DataGrid.RowStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="段落"
                                            Binding="{Binding Id}"
                                            Width="60"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment"
                                            Value="Center" />
                                    <Setter Property="VerticalAlignment"
                                            Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="编号"
                                            Binding="{Binding Character}"
                                            Width="60"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment"
                                            Value="Center" />
                                    <Setter Property="VerticalAlignment"
                                            Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="原文"
                                                Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding OriginalText}"
                                               TextWrapping="Wrap"
                                               Margin="5" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding OriginalText, Mode=OneWay}"
                                             TextWrapping="Wrap"
                                             AcceptsReturn="True"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="5"
                                             IsReadOnly="True" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="译文"
                                                Width="*"
                                                IsReadOnly="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding TranslatedText}"
                                               TextWrapping="Wrap"
                                               Margin="5"
                                               Padding="2" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>

                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding TranslatedText, UpdateSourceTrigger=PropertyChanged}"
                                             TextWrapping="Wrap"
                                             AcceptsReturn="True"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="5" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                <Grid Grid.Row="1"
                      Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left">
                        <ui:Button Content="合并"
                                   Margin="0,0,10,0"
                                   Command="{Binding MergeCommand}"
                                   CommandParameter="{Binding ElementName=dataGridBlocks, Path=SelectedItems}" />
                        <ui:Button Content="拆分"
                                   Margin="0,0,10,0"
                                   Command="{Binding SplitCommand}"
                                   CommandParameter="{Binding ElementName=dataGridBlocks, Path=SelectedItem}" />

                        <ui:Button Content="删除"
                                   Appearance="Danger"
                                   Command="{Binding DeleteCommand}"
                                   Margin="0,0,10,0"
                                   CommandParameter="{Binding ElementName=dataGridBlocks, Path=SelectedItems}" />
                        <ui:Button Content="重置"
                                   Command="{Binding ResetCommand}"
                                   Margin="0,0,10,0"
                                   Appearance="Secondary" />
                        <ui:Button Content="错误项重翻译"
                                   Appearance="Secondary"
                                   Icon="ArrowSync24"
                                   Command="{Binding RetranslateFailedCommand}" />
                    </StackPanel>
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <ui:Button Content="选择CAD文字"
                                   Appearance="Primary"
                                   Icon="{ui:SymbolIcon Symbol=ScanType24 }"
                                   Command="{Binding SelectTextCommand}"
                                   CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" />
                        <ui:Button Content="一键翻译"
                                   Margin="10,0,10,0"
                                   Icon="{ui:SymbolIcon Symbol=BookSearch24,Filled=True}"
                                   Appearance="Caution"
                                   Command="{Binding TranslateCommand}" />
                        <ui:Button Content="应用翻译"
                                   Icon="{ui:SymbolIcon Symbol=Pen32,Filled=False}"
                                   Appearance="Success"
                                   Command="{Binding ApplyToCadCommand}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Grid>
            </Grid>

            <GridSplitter Grid.Row="2"
                          Height="5"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Center"
                          Background="{DynamicResource ControlElevationBorderBrush}" />

            <Border Grid.Row="3"
                    Padding="15,10"
                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    BorderThickness="0,1,0,0"
                    BorderBrush="{DynamicResource ControlElevationBorderBrush}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="220" />
                    </Grid.ColumnDefinitions>

                    <ScrollViewer Name="LogScrollViewer"
                                  Grid.Column="0"
                                  VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding StatusLog}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding Path=., Mode=OneWay}"
                                             TextWrapping="Wrap"
                                             IsReadOnly="True"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="0,0,0,2" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>

                    <Border Grid.Column="1"
                            Background="{DynamicResource ControlElevationBorderBrush}"
                            Width="1"
                            Margin="10,0" />

                    <Grid Grid.Column="2"
                          VerticalAlignment="Stretch">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <ui:ToggleSwitch IsChecked="{Binding IsLiveLayoutEnabled}"
                                         Grid.Row="1"
                                         FontSize="16"
                                         Height="40"
                                         OnContent="实时排版已开启"
                                         OffContent="已关闭实时排版"
                                         HorizontalAlignment="Left"
                                         VerticalAlignment="Stretch" />
                        <TextBlock Grid.Row="2"
                                   Text="排版后行间距"
                                   Opacity="0.8"
                                   Margin="0,0,0,5" />

                        <Grid Grid.Row="3">
                            <ComboBox ItemsSource="{Binding LineSpacingOptions}"
                                      Text="{Binding CurrentLineSpacingInput, UpdateSourceTrigger=LostFocus}"
                                      IsEditable="True"
                                      IsEnabled="{Binding IsLiveLayoutEnabled}">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox"
                                           BasedOn="{StaticResource {x:Type ComboBox}}">
                                        <Style.Triggers>
                                            <Trigger Property="IsEnabled"
                                                     Value="False">
                                                <Setter Property="Foreground"
                                                        Value="Transparent" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                                <ComboBox.ItemTemplate>

                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="{Binding}"
                                                       VerticalAlignment="Center"
                                                       Padding="3,0,0,0" />

                                            <ui:Button Grid.Column="1"
                                                       Command="{Binding DataContext.DeleteLineSpacingOptionCommand, RelativeSource={RelativeSource AncestorType=ComboBox}}"
                                                       CommandParameter="{Binding}"
                                                       Appearance="Transparent"
                                                       FontSize="14"
                                                       FontWeight="Bold"
                                                       Padding="8,0">
                                                <ui:Button.Style>
                                                    <Style TargetType="ui:Button"
                                                           BasedOn="{StaticResource {x:Type ui:Button}}">
                                                        <Setter Property="Content"
                                                                Value="×" />
                                                        <Setter Property="Foreground"
                                                                Value="Gray" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding}"
                                                                         Value="不指定">
                                                                <Setter Property="Visibility"
                                                                        Value="Collapsed" />
                                                            </DataTrigger>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Foreground"
                                                                        Value="Red" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ui:Button.Style>
                                            </ui:Button>
                                        </Grid>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <TextBlock Text="实时排版未采用"
                                       Foreground="LightGray"
                                       FontStyle="Italic"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsLiveLayoutEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                       IsHitTestVisible="False" />
                        </Grid>

                        <TextBlock Grid.Row="5"
                                   Text="当前任务进度"
                                   Opacity="0.8"
                                   Margin="0,0,0,5"
                                   VerticalAlignment="Bottom" />

                        <Grid Grid.Row="6"
                              VerticalAlignment="Bottom">
                            <ProgressBar Value="{Binding ProgressValue}"
                                         Height="20" />
                            <TextBlock Text="{Binding ProgressText}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Foreground="White"
                                       FontWeight="Bold" />
                        </Grid>
                    </Grid>

                </Grid>
            </Border>
        </Grid>
    </Grid>
</ui:FluentWindow>